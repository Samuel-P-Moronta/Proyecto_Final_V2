Index: src/main/java/oppucmm/webservices/REST/Client/RESTClient.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package oppucmm.webservices.REST.Client;\r\n\r\nimport com.google.gson.Gson;\r\nimport com.google.gson.JsonElement;\r\nimport com.google.gson.JsonObject;\r\nimport com.google.gson.JsonParser;\r\nimport io.javalin.Javalin;\r\nimport io.javalin.core.util.RouteOverviewPlugin;\r\nimport io.javalin.plugin.rendering.JavalinRenderer;\r\nimport io.javalin.plugin.rendering.template.JavalinThymeleaf;\r\nimport io.jsonwebtoken.security.Keys;\r\nimport kong.unirest.GenericType;\r\nimport kong.unirest.HttpResponse;\r\nimport kong.unirest.JsonNode;\r\nimport kong.unirest.Unirest;\r\nimport oppucmm.models.*;\r\nimport oppucmm.services.UserService;\r\nimport oppucmm.webservices.REST.Server.JSONParser;\r\nimport oppucmm.webservices.REST.Server.JWT;\r\nimport oppucmm.webservices.REST.Server.RESTController;\r\nimport oppucmm.webservices.REST.Server.RESTService;\r\n\r\nimport javax.crypto.SecretKey;\r\nimport java.io.IOException;\r\nimport java.util.Base64;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\nimport java.util.Map;\r\nimport java.util.concurrent.atomic.AtomicReference;\r\n\r\nimport static io.javalin.apibuilder.ApiBuilder.*;\r\n\r\npublic class RESTClient {\r\n    //private static JWT j1 = null;\r\n    static String url = \"http://localhost:7000/api\",urlLogin = \"http://localhost:7000/api-rest\",token;\r\n    private Javalin app;\r\n    private Map<String, Object> model = new HashMap<>();\r\n\r\n    public RESTClient(Javalin app) {\r\n        this.app = app;\r\n    }\r\n\r\n    public static void main(String[] args) {\r\n        Javalin app2 = Javalin.create(config -> {\r\n            config.addStaticFiles(\"/public\");\r\n            config.registerPlugin(new RouteOverviewPlugin(\"/rutas\"));\r\n            config.enableCorsForAllOrigins();\r\n            JavalinRenderer.register(JavalinThymeleaf.INSTANCE, \".html\");\r\n        }).start(8043);\r\n       // aplicarRutas(app);\r\n\r\n    }\r\n\r\n\r\n    /* Comunicacion con el servidor...*/\r\n    public static String logIn(String username, String password) {\r\n        //HttpResponse<String> repuestaServidor = Unirest.get(String.valueOf(new String[]{\"http://localhost:7000/restApi/\" + \"{autenticar}\"})).routeParam(\"autenticar\", usuario).asString();\r\n        HttpResponse<String> response = Unirest.post(urlLogin+\"/login\").field(\"username\",username).field(\"password\",password).asString();\r\n        Gson gson = new Gson();\r\n        //j1 = gson.fromJson(repuestaServidor.getBody(), JWT.class);\r\n        //System.out.println(\"Token recibido... \" + j1.getToken());\r\n        /*if (j1.getToken() != null) {\r\n            return true;\r\n        }*/\r\n        return response.getBody();\r\n    }\r\n\r\n    public static String listForms() {\r\n        try{\r\n            HttpResponse<String> response = Unirest.get(url+\"/formularios\").header(\"Authorization\",token).asString();\r\n            System.out.println(\"Status: \" + response.getStatus());\r\n            System.out.println(response.getBody());\r\n            return response.getBody();\r\n        }catch (Exception e){\r\n            e.printStackTrace();\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public static String createForm(Form form) {\r\n        System.out.println(\"\\nSend Parameters to the rest server\");\r\n\r\n        JsonObject st = new JsonObject();\r\n\r\n        st.addProperty(\"name\", form.getName());\r\n        st.addProperty(\"sector\", form.getSector());\r\n        st.addProperty(\"academicLevel\", form.getAcademicLevel());\r\n\r\n        JsonObject jsonLocation = new JsonParser().parse(JSONParser.toJson(form.getLocation())).getAsJsonObject();\r\n        st.add(\"location\",jsonLocation);\r\n        JsonObject jsonPhoto = new JsonParser().parse(JSONParser.toJson(form.getPhoto())).getAsJsonObject();\r\n        st.add(\"photo\",jsonPhoto);\r\n        JsonObject jsonUser = new JsonParser().parse(JSONParser.toJson(form.getUser())).getAsJsonObject();\r\n        st.add(\"user\",jsonUser);\r\n        HttpResponse<String> response = Unirest.post(url+\"/formularios/crear\")\r\n                .header(\"Content-Type\", \"application/json\").header(\"Authorization\",token).body(st).asString();\r\n\r\n\r\n        return response.getBody();\r\n    }\r\n\r\n    public static void logOutServer(){\r\n        HttpResponse<String> response = Unirest.get(urlLogin+\"/logOutRest\").asString();\r\n    }\r\n\r\n\r\n\r\n    public void aplicarRutas() {\r\n        //filtro_Cors();\r\n        RESTService restService= new RESTService();\r\n\r\n\r\n        app.get(\"/\", ctx -> ctx.redirect(\"/api\"));\r\n\r\n        app.routes(() -> path(\"/api\", () -> {\r\n\r\n            get(\"/\", ctx -> ctx.redirect(\"api/formularios\"));\r\n\r\n            get(\"/formularios\", ctx -> {\r\n                if(ctx.sessionAttribute(\"user\") != null){\r\n                    User user = UserService.getInstance().buscar(ctx.sessionAttribute(\"user\"));\r\n\r\n                    //List<Form> forms = restService.findFormsByUser(user);\r\n                    //List<String> strings = forms.stream().map(JSONParser::toJson).collect(Collectors.toList());\r\n                    //String strings = JSONParser.toJson(forms);\r\n                    String strings = listForms();\r\n\r\n                    if(JSONParser.isJson(strings)) {\r\n                        model.put(\"formularios\", strings);\r\n                        System.out.println(strings);\r\n                        ctx.render(\"/public/RestTemplate/formRest.html\", model);\r\n                    }\r\n                    else {\r\n\r\n                        JsonObject st = new JsonObject();\r\n                        ErrorResponse response = new ErrorResponse(strings);\r\n                        st.addProperty(\"Error\",strings);\r\n                        ctx.json(response);\r\n                        //ctx.redirect(\"/login\");\r\n                    }\r\n                    //ctx.json(strings);\r\n                }\r\n                else{\r\n\r\n                    ctx.redirect(\"/login\");\r\n                }\r\n            });\r\n\r\n            post(\"/formularios\", ctx -> {\r\n                var files = ctx.uploadedFiles(\"fotoR\");\r\n                AtomicReference<Form> form = new AtomicReference<>(new Form());\r\n                ctx.uploadedFiles(\"fotoR\").forEach(uploadedFile -> {\r\n                    try {\r\n\r\n                        byte[] bytes = uploadedFile.getContent().readAllBytes();\r\n                        String encodedString = Base64.getEncoder().encodeToString(bytes);\r\n                        Photo foto = new Photo(encodedString);\r\n                        foto.setMimeType(uploadedFile.getContentType());\r\n                        if(ctx.sessionAttribute(\"user\") != null) {\r\n                            User user = UserService.getInstance().buscar(ctx.sessionAttribute(\"user\"));\r\n                            Location location = new Location(ctx.formParam(\"longitude\",Double.class).get(),ctx.formParam(\"latitude\",Double.class).get());\r\n                            Form form2 = new Form(foto, ctx.formParam(\"fullNameRest\"),ctx.formParam(\"sectorRest\"),\r\n                                    ctx.formParam(\"academicLevelRest\"),user,location);\r\n\r\n                            form.set(form2);\r\n                        }\r\n                        else {\r\n                            ctx.redirect(\"/\");\r\n                        }\r\n\r\n                        //product = productService.find(ctx.pathParam(\"id\", Integer.class).get());\r\n\r\n                        //productService.update(product);\r\n\r\n                    } catch (IOException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n\r\n                    //restService.addForm(form.get());\r\n                    createForm(form.get());\r\n                });\r\n\r\n                ctx.redirect(\"/\");\r\n\r\n\r\n            });\r\n\r\n\r\n\r\n\r\n\r\n        }));\r\n\r\n\r\n        app.get(\"/logOutRest\", ctx -> {\r\n            if (ctx.sessionAttribute(\"user\") != null) {\r\n                ctx.sessionAttribute(\"user\", null);\r\n                ctx.req.getSession().invalidate();\r\n            }\r\n            if (ctx.cookie(\"user\") != null) {\r\n                ctx.removeCookie(\"user\");\r\n            }\r\n            logOutServer();\r\n            ctx.redirect(\"/\");\r\n        });\r\n\r\n\r\n\r\n        app.get(\"/login\",ctx -> {\r\n            ctx.render(\"public/RestTemplate/loginRest.html\");\r\n        });\r\n\r\n        app.post(\"/login\",ctx -> {\r\n\r\n           /* String username = ctx.formParam(\"username\");\r\n            String password = ctx.formParam(\"password\");\r\n            User user = restService.logIn(username,password);\r\n            SecretKey secretKey = Keys.hmacShaKeyFor(RESTController.KEY_SECRET.getBytes());*/\r\n            String request = logIn(ctx.formParam(\"username\"),ctx.formParam(\"password\"));\r\n            JsonObject jsonObject = new JsonParser().parse(request).getAsJsonObject();\r\n\r\n            if(jsonObject.get(\"user\") != null){\r\n                //User user = new Gson().fromJson(jsonObject.get(\"user\"),User.class);\r\n                String username = jsonObject.get(\"user\").getAsString();\r\n                User user = UserService.getInstance().buscar(username);\r\n                ctx.sessionAttribute(\"user\", user.getUsername());\r\n                token = \"Bearer\";\r\n                token += jsonObject.get(\"token\").getAsString();\r\n                ctx.redirect(\"api/formularios\");\r\n            }\r\n            else {\r\n                model.put(\"Error\", \"Usuario o contrase√±a incorrectos!\");\r\n                ctx.render(\"public/RestTemplate/loginRest.html\", model);\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/oppucmm/webservices/REST/Client/RESTClient.java b/src/main/java/oppucmm/webservices/REST/Client/RESTClient.java
--- a/src/main/java/oppucmm/webservices/REST/Client/RESTClient.java	(revision 2e20585f3e432e4febd960c5e73b67664898b0df)
+++ b/src/main/java/oppucmm/webservices/REST/Client/RESTClient.java	(date 1620006539627)
@@ -32,7 +32,10 @@
 
 public class RESTClient {
     //private static JWT j1 = null;
-    static String url = "http://localhost:7000/api",urlLogin = "http://localhost:7000/api-rest",token;
+    //https://astrocaribbean.tech/api
+    //https://astrocaribbean.tech//api-rest
+     static String url = "https://astrocaribbean.tech/api",urlLogin = "https://astrocaribbean.tech/api-rest",token;
+    // static String url = "http://localhost:7000/api",urlLogin = "http://localhost:7000/api-rest",token;
     private Javalin app;
     private Map<String, Object> model = new HashMap<>();
 
Index: src/main/resources/public/RestTemplate/formRest.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!doctype html>\r\n<html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\" >\r\n<head>\r\n    <title>Registro | OP-PUCMM</title>\r\n    <meta charset=\"UTF-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\">\r\n    <!-- VENDOR CSS -->\r\n    <link rel=\"stylesheet\" href=\"../assets/css/bootstrap.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../assets/vendor/font-awesome/css/font-awesome.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../assets/vendor/linearicons/style.css\">\r\n    <!-- MAIN CSS -->\r\n    <link rel=\"stylesheet\" href=\"../assets/css/main.css\">\r\n    <!-- GOOGLE FONTS -->\r\n    <link href=\"https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700\" rel=\"stylesheet\">\r\n    <!-- ICONS -->\r\n    <link rel=\"apple-touch-icon\" sizes=\"76x76\" href=\"../assets/img/pucmm-logo.png\">\r\n    <link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"../assets/img/favicon.png\">\r\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\" integrity=\"sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN\" crossorigin=\"anonymous\">\r\n\r\n    <style>\r\n        body {\r\n            background-color: #00A0F0;\r\n            font-family: 'Open Sans', sans-serif;\r\n            margin: 0;\r\n        }\r\n\r\n        .header h4 {\r\n            border-bottom: 1px solid #f0f0f0;\r\n            background-color: #f7f7f7;\r\n            padding: 20px 40px;\r\n            text-align: center;\r\n        }\r\n\r\n        #formLista{\r\n\r\n        }\r\n    </style>\r\n\r\n\r\n\r\n</head>\r\n\r\n<body onload=\"GEOLOCATION\">\r\n<!-- WRAPPER -->\r\n<div id=\"wrapper\">\r\n    <div class=\"vertical-align-wrap\">\r\n        <div class=\"vertical-align-middle\">\r\n            <div class=\"panel\" style=\"width: 900px; margin-left: auto; margin-right: auto;\">\r\n                <div class=\"left\">\r\n                    <div class=\"panel-body\">\r\n                        <div class=\"header\">\r\n                            <h4 class=\"lead\">REST CLIENT</h4>\r\n                            <form method=\"get\" action=\"/logOutRest\">\r\n                                <button type=\"submit\" class=\"btn btn-success\">\r\n                                    <a class=\"btn btn-success update-pro\" data-sm-link-text=\"CLICK\"\r\n                                       target=\"_blank\"><i class=\"fa fa-sign-out\"></i>\r\n                                        <span>LOG OUT</span></a>\r\n                                </button>\r\n                            </form>\r\n                        </div>\r\n                        <br>\r\n                        <form method=\"post\" enctype=\"multipart/form-data\" class=\"form-auth-small\" action=\"/api/formularios\">\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-id-card\"></i></span>\r\n                                    <input  type=\"text\" class=\"form-control\" name=\"fullNameRest\" id=\"fullNameRest\" placeholder=\"Nombre\" required />\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-map\"></i></span>\r\n                                    <input type=\"text\" class=\"form-control\" name=\"sectorRest\" id=\"sectorRest\" placeholder=\"Sector\" required  onclick=\"GEOLOCATION()\"/>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-file-picture-o\"></i></span>\r\n                                    <input  class=\"form-control\" name=\"fotoR\" id=\"foto\" type=\"file\"  placeholder=\"Foto\" multiple required onclick=\"GEOLOCATION()\" />\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-paper-plane\"></i></span>\r\n                                    <select name=\"academicLevelRest\" id=\"academicLevelRest\" placeholder=\"role\"\r\n                                            class=\"form-control\"\r\n                                            aria-required=\"true\" required>\r\n                                        <option value=\"\">Nivel Academico</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Basico\">Administrador</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Medio\">Medio</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Grado\">Grado</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Maestria\">Maestria</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Doctorado\">Doctorado</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                            <input type=\"hidden\" name=\"latitude\" id=\"latitude\" value=\"\">\r\n                            <input type=\"hidden\" id=\"longitude\" name=\"longitude\" value=\"\">\r\n                            <div class=\"col-md-12\">\r\n                                <br>\r\n                                <h6 DIV ALIGN=center th:text=\"${Error}\" style=\"color:#ff0000\"></h6>\r\n                                <h6 DIV ALIGN=center th:text=\"${Success}\" style=\"color:#00A0F0\"></h6>\r\n                            </div>\r\n                            <button type=\"submit\" class=\"btn btn-primary btn-lg btn-block\"><i class=\"fa fa-save\"></i>GUARDAR\r\n                                FORMULARIO\r\n                            </button>\r\n                            <p></p>\r\n                            <!-- END LOGIN ENTERING -->\r\n                            <div class=\"col-md-12\">\r\n                                <div class=\"panel\">\r\n                                    <div class=\"panel-body\">\r\n                                        <h3 class=\"panel-title\">LISTADO DE FORMULARIOS</h3>\r\n                                        <div class=\"table-responsive\">\r\n\r\n                                            <!--<div class=\"container\">\r\n                                                <div class=\"starter-template\">\r\n                                                    <fieldset>\r\n                                                        <h1> <u>Your Order</u> </h1>\r\n\r\n                                                        <table id = \"dataTable\" border=\"1\">\r\n                                                            <th>FOTO</th>\r\n                                                            <th>NOMBRE COMPLETO</th>\r\n                                                            <th>SECTOR</th>\r\n                                                            <th>NIVEL ACADEMICO</th>\r\n                                                            <th>USUARIO</th>\r\n                                                        </table>\r\n                                                    </fieldset>\r\n                                                </div>\r\n                                            </div>-->\r\n                                            <table class=\"table\" id=\"dataTabla\">\r\n                                                <thead>\r\n                                                <tr>\r\n                                                    <th>FOTO</th>\r\n                                                    <th>NOMBRE COMPLETO</th>\r\n                                                    <th>SECTOR</th>\r\n                                                    <th>NIVEL ACADEMICO</th>\r\n                                                    <th>USUARIO</th>\r\n\r\n                                                </tr>\r\n                                                </thead>\r\n                                                <tbody id=\"formLista\" name=\"formLista\">\r\n                                                <tr th:each=\"aux : ${formularios}\" >\r\n\r\n                                                </tr>\r\n                                                </tbody>\r\n\r\n                                            </table>\r\n                                            <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js\"></script>\r\n                                            <script th:inline=\"javascript\">\r\n\r\n                                                /*<![CDATA[*/\r\n                                                // var forms = JSON.parse([[${formularios}]]);\r\n                                                var forms = JSON.parse(/*[[${formularios}]]*/ 'default');\r\n\r\n\r\n                                                /*]]>*/\r\n\r\n                                                // '[{\\\"id\\\":1,\\\"name\\\":\\\"Juan\\\",\\\"sector\\\":\\\"Santiago\\\",\\\"academicLevel\\\":\\\"Grado\\\",\\\"photo\\\":{\\\"fotoBase64\\\":\\\"\\\"},\\\"user\\\":{\\\"username\\\":\\\"admin\\\",\\\"fullName\\\":\\\"Samuel PeÔøΩa\\\",\\\"password\\\":\\\"admin\\\",\\\"rolesList\\\":[\\\"ROLE_EMPLEADO\\\",\\\"ROLE_ADMIN\\\"]},\\\"location\\\":{\\\"longitude\\\":-70.663414,\\\"latitude\\\":19.453105}}, {\\\"id\\\":2,\\\"name\\\":\\\"Soto Bello\\\",\\\"sector\\\":\\\"Santiago\\\",\\\"academicLevel\\\":\\\"Doctorado\\\",\\\"photo\\\":{\\\"fotoBase64\\\":\\\"\\\"},\\\"user\\\":{\\\"username\\\":\\\"admin\\\",\\\"fullName\\\":\\\"Samuel PeÔøΩa\\\",\\\"password\\\":\\\"admin\\\",\\\"rolesList\\\":[\\\"ROLE_EMPLEADO\\\",\\\"ROLE_ADMIN\\\"]},\\\"location\\\":{\\\"longitude\\\":-70.644531,\\\"latitude\\\":19.453105}}, {\\\"id\\\":3,\\\"name\\\":\\\"Dilapa Batista\\\",\\\"sector\\\":\\\"Santiago\\\",\\\"academicLevel\\\":\\\"Medio\\\",\\\"photo\\\":{\\\"fotoBase64\\\":\\\"\\\"},\\\"user\\\":{\\\"username\\\":\\\"admin\\\",\\\"fullName\\\":\\\"Samuel PeÔøΩa\\\",\\\"password\\\":\\\"admin\\\",\\\"rolesList\\\":[\\\"ROLE_EMPLEADO\\\",\\\"ROLE_ADMIN\\\"]},\\\"location\\\":{\\\"longitude\\\":-70.664787,\\\"latitude\\\":19.473174}}]'\r\n                                                console.log(\"forms: \")\r\n                                                //console.log(forms)\r\n                                                productListSuccess(forms)\r\n\r\n                                                function productListSuccess(formularios) {\r\n                                                    console.log(\"aqui: \")\r\n\r\n\r\n                                                    var fila = \"\"\r\n                                                    for (var key in formularios) {\r\n                                                        fila += \"<tr>\"\r\n                                                        fila += \"<td>\" + \"<img src=\" +\"data:\"+formularios[key].photo.mimeType+\";base64,\"+ formularios[key].photo.fotoBase64 + \" style=\\\"height: 100px; width: 100px\\\" alt=\\\"No tiene foto\\\" >\" + \"</td>\"\r\n\r\n                                                        //src=\"@{'data:'+${aux.getMimeType()}+';base64,'+${aux.getFotoBase64()}}\"\r\n                                                        fila += \"<td>\" + formularios[key].name + \"</td>\"\r\n                                                        fila += \"<td>\" + formularios[key].sector + \"</td>\"\r\n                                                        fila += \"<td>\" + formularios[key].academicLevel + \"</td>\"\r\n                                                        fila += \"<td>\" + formularios[key].user.username + \"</td>\"\r\n                                                        fila += \"</tr>\"\r\n                                                    }\r\n                                                    document.getElementById(\"formLista\").innerHTML = fila\r\n\r\n                                                }\r\n                                            </script>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n                <div class=\"clearfix\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script>\r\n    function GEOLOCATION(){\r\n\r\n        function success(pos){\r\n            console.log('Working...')\r\n            var crd = pos.coords\r\n            document.querySelector(\"#latitude\").value = crd.latitude;\r\n            document.querySelector(\"#longitude\").value = crd.longitude;\r\n        }\r\n        navigator.geolocation.getCurrentPosition(success)\r\n    }\r\n\r\n</script>\r\n\r\n\r\n<!-- END WRAPPER -->\r\n\r\n</body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/public/RestTemplate/formRest.html b/src/main/resources/public/RestTemplate/formRest.html
--- a/src/main/resources/public/RestTemplate/formRest.html	(revision 2e20585f3e432e4febd960c5e73b67664898b0df)
+++ b/src/main/resources/public/RestTemplate/formRest.html	(date 1620007268833)
@@ -131,9 +131,11 @@
                                                 <thead>
                                                 <tr>
                                                     <th>FOTO</th>
-                                                    <th>NOMBRE COMPLETO</th>
+                                                    <th>NOMBRE</th>
                                                     <th>SECTOR</th>
-                                                    <th>NIVEL ACADEMICO</th>
+                                                    <th>N. ACADEMICO</th>
+                                                    <th>LONGITUDE</th>
+                                                    <th>LATITUDE</th>
                                                     <th>USUARIO</th>
 
                                                 </tr>
@@ -167,12 +169,14 @@
                                                     var fila = ""
                                                     for (var key in formularios) {
                                                         fila += "<tr>"
-                                                        fila += "<td>" + "<img src=" +"data:"+formularios[key].photo.mimeType+";base64,"+ formularios[key].photo.fotoBase64 + " style=\"height: 100px; width: 100px\" alt=\"No tiene foto\" >" + "</td>"
+                                                        fila += "<td>" + "<img src="+formularios[key].photo.fotoBase64 + " style=\"height: 100px; width: 100px\" alt=\"No tiene foto\" >" + "</td>"
 
                                                         //src="@{'data:'+${aux.getMimeType()}+';base64,'+${aux.getFotoBase64()}}"
                                                         fila += "<td>" + formularios[key].name + "</td>"
                                                         fila += "<td>" + formularios[key].sector + "</td>"
                                                         fila += "<td>" + formularios[key].academicLevel + "</td>"
+                                                        fila += "<td>" + formularios[key].location.longitude + "</td>"
+                                                        fila += "<td>" + formularios[key].location.latitude + "</td>"
                                                         fila += "<td>" + formularios[key].user.username + "</td>"
                                                         fila += "</tr>"
                                                     }
Index: src/main/java/oppucmm/webservices/REST/Server/RESTController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package oppucmm.webservices.REST.Server;\r\n\r\nimport com.google.gson.JsonArray;\r\nimport com.google.gson.JsonObject;\r\nimport com.google.gson.JsonParser;\r\nimport io.javalin.Javalin;\r\nimport io.jsonwebtoken.*;\r\nimport io.jsonwebtoken.security.Keys;\r\nimport oppucmm.models.*;\r\nimport oppucmm.services.UserService;\r\n\r\nimport javax.crypto.SecretKey;\r\nimport java.time.LocalDateTime;\r\nimport java.time.ZoneOffset;\r\nimport java.util.*;\r\nimport java.util.concurrent.atomic.AtomicReference;\r\n\r\nimport static io.javalin.apibuilder.ApiBuilder.*;\r\n\r\npublic class RESTController {\r\n\r\n    private Javalin app;\r\n    public final static String KEY_SECRET = \"asd12D1234dfr123@#4Fsdcasdd5g78a\";\r\n    private Map<String, Object> errors = new HashMap<>();\r\n\r\n    public RESTController(Javalin app) {\r\n        this.app = app;\r\n    }\r\n\r\n    public void aplicarRutas() {\r\n       // filtro_Cors();\r\n        RESTService restService= new RESTService();\r\n        Map<String, Object> model = new HashMap<>();\r\n\r\n\r\n       // app.get(\"/\", ctx -> ctx.redirect(\"/api\"));\r\n\r\n        app.routes(() -> path(\"/api\", () -> {\r\n\r\n            /*after(ctx -> {\r\n                ctx.header(\"Content-Type\", \"application/json\");\r\n            });*/\r\n            String header = \"Authorization\";\r\n            String prefijo = \"Bearer\";\r\n            before(\"/*\",ctx -> {\r\n                String headerAutentificacion = ctx.header(header);\r\n                if(headerAutentificacion ==null || !headerAutentificacion.startsWith(prefijo)){\r\n                    ctx.status(403).result(\"No tiene permiso para acceder al recurso, no enviando header de autorizaci√≥n\");\r\n                    //model.put(\"Error\",\"No tiene permiso para acceder al recurso, no enviando header de autorizaci√≥n\");\r\n                    errors.put(\"403\",\"No tiene permiso para acceder al recurso, no enviando header de autorizaci√≥n\");\r\n                    //return;\r\n                }\r\n                if(errors.isEmpty()) {\r\n                    String tramaJwt = headerAutentificacion.replace(prefijo, \"\");\r\n                    try {\r\n                        Claims claims = Jwts.parser()\r\n                                .setSigningKey(Keys.hmacShaKeyFor(KEY_SECRET.getBytes()))\r\n                                .parseClaimsJws(tramaJwt).getBody();\r\n                        //mostrando la informaci√≥n para demostraci√≥n.\r\n                        System.out.println(\"Mostrando el JWT recibido: \" + claims.toString());\r\n                    } catch (ExpiredJwtException | MalformedJwtException | SignatureException e) { //Excepciones comunes\r\n                        errors.put(\"403\", e.getMessage());\r\n                        ctx.status(403).result(e.getMessage());\r\n                    }\r\n                }\r\n\r\n            });\r\n\r\n            get(\"/\", ctx -> ctx.redirect(\"api/formularios\"));\r\n\r\n            get(\"/formularios\", ctx -> {\r\n                if(errors.isEmpty()) {\r\n                    if (ctx.sessionAttribute(\"user\") != null) {\r\n                        User user = UserService.getInstance().buscar(ctx.sessionAttribute(\"user\"));\r\n                        List<Form> forms = restService.findFormsByUser(user);\r\n                        //List<String> strings = forms.stream().map(JSONParser::toJson).collect(Collectors.toList());\r\n                        String strings = JSONParser.toJson(forms);\r\n                        model.put(\"formularios\", strings);\r\n                        System.out.println(strings);\r\n                        //ctx.render(\"/public/RestTemplate/formRest.html\",model);\r\n                        JsonArray jsonObject = new JsonParser().parse(strings).getAsJsonArray();\r\n                        ctx.json(forms);\r\n                    } else {\r\n\r\n                        ctx.redirect(\"/login\");\r\n                    }\r\n                }\r\n                else {\r\n\r\n                    ctx.status(403).result(errors.get(\"403\").toString());\r\n                    errors = new HashMap<>();\r\n                }\r\n            });\r\n\r\n            post(\"/formularios/crear\", ctx -> {\r\n                var files = ctx.uploadedFiles(\"fotoR\");\r\n                //AtomicReference<Form> form = new AtomicReference<>(new Form());\r\n                Form form = ctx.bodyAsClass(Form.class);\r\n                /*ctx.uploadedFiles(\"fotoR\").forEach(uploadedFile -> {\r\n                    try {\r\n\r\n                        byte[] bytes = uploadedFile.getContent().readAllBytes();\r\n                        String encodedString = Base64.getEncoder().encodeToString(bytes);\r\n                        Photo foto = new Photo(encodedString);\r\n                        foto.setMimeType(uploadedFile.getContentType());\r\n                        User user = UserService.getInstance().buscar(ctx.sessionAttribute(\"user\"));\r\n\r\n                        //product = productService.find(ctx.pathParam(\"id\", Integer.class).get());\r\n\r\n                        //productService.update(product);\r\n                        Location location = new Location(ctx.formParam(\"longitude\",Double.class).get(),ctx.formParam(\"latitude\",Double.class).get());\r\n                      Form form2 = new Form(foto, ctx.formParam(\"fullNameRest\"),ctx.formParam(\"sectorRest\"),\r\n                                ctx.formParam(\"academicLevelRest\"),user,location);\r\n\r\n                      form.set(form2);\r\n                    } catch (IOException e) {\r\n                        e.printStackTrace();\r\n                    }\r\n\r\n                    restService.addForm(form.get());\r\n                });*/\r\n                restService.addForm(form);\r\n                //ctx.redirect(\"/\");\r\n                ctx.json(form);\r\n\r\n            });\r\n\r\n\r\n\r\n\r\n\r\n        }));\r\n\r\n\r\n            app.get(\"/api-rest/logOutRest\", ctx -> {\r\n                if (ctx.sessionAttribute(\"user\") != null) {\r\n                    ctx.sessionAttribute(\"user\", null);\r\n                    ctx.req.getSession().invalidate();\r\n                }\r\n                if (ctx.cookie(\"user\") != null) {\r\n                    ctx.removeCookie(\"user\");\r\n                }\r\n                //ctx.redirect(\"/\");\r\n                ctx.status(200);\r\n            });\r\n\r\n\r\n\r\n        /*app.get(\"/api/login\",ctx -> {\r\n            ctx.render(\"public/RestTemplate/loginRest.html\");\r\n        });*/\r\n\r\n        app.post(\"/api-rest/login\",ctx -> {\r\n\r\n            String username = ctx.formParam(\"username\");\r\n            String password = ctx.formParam(\"password\");\r\n            User user = restService.logIn(username,password);\r\n            SecretKey secretKey = Keys.hmacShaKeyFor(RESTController.KEY_SECRET.getBytes());\r\n\r\n            if(user != null){\r\n\r\n                ctx.sessionAttribute(\"user\", username);\r\n\r\n                //ctx.redirect(\"api/formularios\");\r\n\r\n                ctx.json(generateJWT(user));\r\n            }\r\n            else {\r\n                model.put(\"Error\", \"Bad Credentials\");\r\n                ctx.json(model);\r\n               // ctx.render(\"public/RestTemplate/loginRest.html\", model);\r\n            }\r\n\r\n        });\r\n\r\n\r\n    }\r\n\r\n    private void filtro_Cors(){\r\n        //  Filtro para validar el CORS.(Intercambio de recursos de origen cruzado).\r\n        app.before(\"/*\", ctx ->{\r\n            ctx.header(\"Access-Control-Allow-Origin\", \"*\");\r\n        });\r\n        // Enviando la informaci√≥n a solicitud del CORS.\r\n        app.options(\"/*\", ctx -> {\r\n            System.out.println(\"Accediendo al metodo de options\");\r\n\r\n            String accessControlRequestHeaders = ctx.header(\"Access-Control-Request-Headers\");\r\n            if (accessControlRequestHeaders != null) {\r\n                ctx.header(\"Access-Control-Allow-Headers\",accessControlRequestHeaders);\r\n            }\r\n\r\n            String accessControlRequestMethod = ctx.header(\"Access-Control-Request-Method\");\r\n            if (accessControlRequestMethod != null) {\r\n                ctx.header(\"Access-Control-Allow-Methods\",accessControlRequestMethod);\r\n            }\r\n            ctx.status(200).result(\"OK\");\r\n        });\r\n    }\r\n\r\n    private static JWT generateJWT(User u1){\r\n        JWT j1 = new JWT();\r\n        //Generating the key\r\n        SecretKey secretKey = Keys.hmacShaKeyFor(KEY_SECRET.getBytes());\r\n        //Valid date\r\n        LocalDateTime localDateTime = LocalDateTime.now().plusMinutes(5);\r\n\r\n        //Generate the JWT (frame)\r\n        String jwt = Jwts.builder()\r\n                .setIssuer(\"PUCMM-FINAL-PROJECT\")\r\n                .setSubject(\"OP | PUCMM API's\")\r\n                .setExpiration(Date.from(localDateTime.toInstant(ZoneOffset.ofHours(-4))))\r\n                .claim(\"username\", u1.getUsername())\r\n                .signWith(secretKey)\r\n                .compact();\r\n        j1.setToken(jwt);\r\n        j1.setUser(u1.getUsername());\r\n        JsonObject st = new JsonObject();\r\n        /*JsonObject jsonJWT = new JsonParser().parse(JSONParser.toJson(j1)).getAsJsonObject();\r\n        st.add(\"token\",jsonJWT);\r\n        st.addProperty(\"user\",u1.getUsername());*/\r\n        return j1;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/oppucmm/webservices/REST/Server/RESTController.java b/src/main/java/oppucmm/webservices/REST/Server/RESTController.java
--- a/src/main/java/oppucmm/webservices/REST/Server/RESTController.java	(revision 2e20585f3e432e4febd960c5e73b67664898b0df)
+++ b/src/main/java/oppucmm/webservices/REST/Server/RESTController.java	(date 1620005988454)
@@ -204,21 +204,23 @@
         SecretKey secretKey = Keys.hmacShaKeyFor(KEY_SECRET.getBytes());
         //Valid date
         LocalDateTime localDateTime = LocalDateTime.now().plusMinutes(5);
-
+        long tiempo = System.currentTimeMillis();
         //Generate the JWT (frame)
         String jwt = Jwts.builder()
                 .setIssuer("PUCMM-FINAL-PROJECT")
                 .setSubject("OP | PUCMM API's")
-                .setExpiration(Date.from(localDateTime.toInstant(ZoneOffset.ofHours(-4))))
+                .setIssuedAt(new Date())
+                .setExpiration(new Date(tiempo+120000))
+                //.setExpiration(Date.from(localDateTime.toInstant(ZoneOffset.ofHours(-4))))
                 .claim("username", u1.getUsername())
                 .signWith(secretKey)
                 .compact();
         j1.setToken(jwt);
         j1.setUser(u1.getUsername());
         JsonObject st = new JsonObject();
-        /*JsonObject jsonJWT = new JsonParser().parse(JSONParser.toJson(j1)).getAsJsonObject();
-        st.add("token",jsonJWT);
-        st.addProperty("user",u1.getUsername());*/
+    /*JsonObject jsonJWT = new JsonParser().parse(JSONParser.toJson(j1)).getAsJsonObject();
+    st.add("token",jsonJWT);
+    st.addProperty("user",u1.getUsername());*/
         return j1;
     }
 }
Index: build/tmp/compileJava/source-classes-mapping.txt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>oppucmm/webservices/SOAP/Server/SOAPController.java\r\n oppucmm.webservices.SOAP.Server.SOAPController\r\noppucmm/models/Location.java\r\n oppucmm.models.Location\r\noppucmm/webservices/REST/Server/Services.java\r\n oppucmm.webservices.REST.Server.Services\r\noppucmm/services/UserService.java\r\n oppucmm.services.UserService\r\noppucmm/services/connect/DataBaseServices.java\r\n oppucmm.services.connect.DataBaseServices\r\noppucmm/controllers/OpPucmmException.java\r\n oppucmm.controllers.OpPucmmException\r\noppucmm/webservices/REST/Server/RESTService.java\r\n oppucmm.webservices.REST.Server.RESTService\r\noppucmm/webservices/REST/Client/RESTClient.java\r\n oppucmm.webservices.REST.Client.RESTClient\r\noppucmm/controllers/WebSocketController.java\r\n oppucmm.controllers.WebSocketController\r\n oppucmm.controllers.WebSocketController$1\r\noppucmm/webservices/REST/Server/JSONParser.java\r\n oppucmm.webservices.REST.Server.JSONParser\r\noppucmm/models/FormAux.java\r\n oppucmm.models.FormAux\r\noppucmm/models/Photo.java\r\n oppucmm.models.Photo\r\noppucmm/controllers/Controller.java\r\n oppucmm.controllers.Controller\r\noppucmm/models/RoleApp.java\r\n oppucmm.models.RoleApp\r\noppucmm/services/connect/DataBaseRepository.java\r\n oppucmm.services.connect.DataBaseRepository\r\noppucmm/Main.java\r\n oppucmm.Main\r\noppucmm/webservices/REST/Server/RESTController.java\r\n oppucmm.webservices.REST.Server.RESTController\r\noppucmm/controllers/ControladorBase.java\r\n oppucmm.controllers.ControladorBase\r\noppucmm/controllers/FormController.java\r\n oppucmm.controllers.FormController\r\noppucmm/webservices/SOAP/Server/SOAPService.java\r\n oppucmm.webservices.SOAP.Server.SOAPService\r\noppucmm/webservices/REST/Server/JWT.java\r\n oppucmm.webservices.REST.Server.JWT\r\noppucmm/webservices/REST/Server/RESTApi.java\r\n oppucmm.webservices.REST.Server.RESTApi\r\noppucmm/models/Form.java\r\n oppucmm.models.Form\r\noppucmm/controllers/UserController.java\r\n oppucmm.controllers.UserController\r\noppucmm/services/FormService.java\r\n oppucmm.services.FormService\r\noppucmm/models/ErrorResponse.java\r\n oppucmm.models.ErrorResponse\r\noppucmm/models/User.java\r\n oppucmm.models.User\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/build/tmp/compileJava/source-classes-mapping.txt b/build/tmp/compileJava/source-classes-mapping.txt
--- a/build/tmp/compileJava/source-classes-mapping.txt	(revision 2e20585f3e432e4febd960c5e73b67664898b0df)
+++ b/build/tmp/compileJava/source-classes-mapping.txt	(date 1620006546760)
@@ -12,8 +12,8 @@
  oppucmm.controllers.OpPucmmException
 oppucmm/webservices/REST/Server/RESTService.java
  oppucmm.webservices.REST.Server.RESTService
-oppucmm/webservices/REST/Client/RESTClient.java
- oppucmm.webservices.REST.Client.RESTClient
+oppucmm/models/User.java
+ oppucmm.models.User
 oppucmm/controllers/WebSocketController.java
  oppucmm.controllers.WebSocketController
  oppucmm.controllers.WebSocketController$1
@@ -29,8 +29,8 @@
  oppucmm.models.RoleApp
 oppucmm/services/connect/DataBaseRepository.java
  oppucmm.services.connect.DataBaseRepository
-oppucmm/Main.java
- oppucmm.Main
+oppucmm/models/ErrorResponse.java
+ oppucmm.models.ErrorResponse
 oppucmm/webservices/REST/Server/RESTController.java
  oppucmm.webservices.REST.Server.RESTController
 oppucmm/controllers/ControladorBase.java
@@ -49,7 +49,7 @@
  oppucmm.controllers.UserController
 oppucmm/services/FormService.java
  oppucmm.services.FormService
-oppucmm/models/ErrorResponse.java
- oppucmm.models.ErrorResponse
-oppucmm/models/User.java
- oppucmm.models.User
+oppucmm/webservices/REST/Client/RESTClient.java
+ oppucmm.webservices.REST.Client.RESTClient
+oppucmm/Main.java
+ oppucmm.Main
Index: build/resources/main/public/RestTemplate/formRest.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!doctype html>\r\n<html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\" >\r\n<head>\r\n    <title>Registro | OP-PUCMM</title>\r\n    <meta charset=\"UTF-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\">\r\n    <!-- VENDOR CSS -->\r\n    <link rel=\"stylesheet\" href=\"../assets/css/bootstrap.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../assets/vendor/font-awesome/css/font-awesome.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../assets/vendor/linearicons/style.css\">\r\n    <!-- MAIN CSS -->\r\n    <link rel=\"stylesheet\" href=\"../assets/css/main.css\">\r\n    <!-- GOOGLE FONTS -->\r\n    <link href=\"https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700\" rel=\"stylesheet\">\r\n    <!-- ICONS -->\r\n    <link rel=\"apple-touch-icon\" sizes=\"76x76\" href=\"../assets/img/pucmm-logo.png\">\r\n    <link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"../assets/img/favicon.png\">\r\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\" integrity=\"sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN\" crossorigin=\"anonymous\">\r\n\r\n    <style>\r\n        body {\r\n            background-color: #00A0F0;\r\n            font-family: 'Open Sans', sans-serif;\r\n            margin: 0;\r\n        }\r\n\r\n        .header h4 {\r\n            border-bottom: 1px solid #f0f0f0;\r\n            background-color: #f7f7f7;\r\n            padding: 20px 40px;\r\n            text-align: center;\r\n        }\r\n\r\n        #formLista{\r\n\r\n        }\r\n    </style>\r\n\r\n\r\n\r\n</head>\r\n\r\n<body onload=\"GEOLOCATION\">\r\n<!-- WRAPPER -->\r\n<div id=\"wrapper\">\r\n    <div class=\"vertical-align-wrap\">\r\n        <div class=\"vertical-align-middle\">\r\n            <div class=\"panel\" style=\"width: 900px; margin-left: auto; margin-right: auto;\">\r\n                <div class=\"left\">\r\n                    <div class=\"panel-body\">\r\n                        <div class=\"header\">\r\n                            <h4 class=\"lead\">REST CLIENT</h4>\r\n                            <form method=\"get\" action=\"/logOutRest\">\r\n                                <button type=\"submit\" class=\"btn btn-success\">\r\n                                    <a class=\"btn btn-success update-pro\" data-sm-link-text=\"CLICK\"\r\n                                       target=\"_blank\"><i class=\"fa fa-sign-out\"></i>\r\n                                        <span>LOG OUT</span></a>\r\n                                </button>\r\n                            </form>\r\n                        </div>\r\n                        <br>\r\n                        <form method=\"post\" enctype=\"multipart/form-data\" class=\"form-auth-small\" action=\"/api/formularios\">\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-id-card\"></i></span>\r\n                                    <input  type=\"text\" class=\"form-control\" name=\"fullNameRest\" id=\"fullNameRest\" placeholder=\"Nombre\" required />\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-map\"></i></span>\r\n                                    <input type=\"text\" class=\"form-control\" name=\"sectorRest\" id=\"sectorRest\" placeholder=\"Sector\" required  onclick=\"GEOLOCATION()\"/>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-file-picture-o\"></i></span>\r\n                                    <input  class=\"form-control\" name=\"fotoR\" id=\"foto\" type=\"file\"  placeholder=\"Foto\" multiple required onclick=\"GEOLOCATION()\" />\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-paper-plane\"></i></span>\r\n                                    <select name=\"academicLevelRest\" id=\"academicLevelRest\" placeholder=\"role\"\r\n                                            class=\"form-control\"\r\n                                            aria-required=\"true\" required>\r\n                                        <option value=\"\">Nivel Academico</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Basico\">Administrador</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Medio\">Medio</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Grado\">Grado</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Maestria\">Maestria</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Doctorado\">Doctorado</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                            <input type=\"hidden\" name=\"latitude\" id=\"latitude\" value=\"\">\r\n                            <input type=\"hidden\" id=\"longitude\" name=\"longitude\" value=\"\">\r\n                            <div class=\"col-md-12\">\r\n                                <br>\r\n                                <h6 DIV ALIGN=center th:text=\"${Error}\" style=\"color:#ff0000\"></h6>\r\n                                <h6 DIV ALIGN=center th:text=\"${Success}\" style=\"color:#00A0F0\"></h6>\r\n                            </div>\r\n                            <button type=\"submit\" class=\"btn btn-primary btn-lg btn-block\"><i class=\"fa fa-save\"></i>GUARDAR\r\n                                FORMULARIO\r\n                            </button>\r\n                            <p></p>\r\n                            <!-- END LOGIN ENTERING -->\r\n                            <div class=\"col-md-12\">\r\n                                <div class=\"panel\">\r\n                                    <div class=\"panel-body\">\r\n                                        <h3 class=\"panel-title\">LISTADO DE FORMULARIOS</h3>\r\n                                        <div class=\"table-responsive\">\r\n\r\n                                            <!--<div class=\"container\">\r\n                                                <div class=\"starter-template\">\r\n                                                    <fieldset>\r\n                                                        <h1> <u>Your Order</u> </h1>\r\n\r\n                                                        <table id = \"dataTable\" border=\"1\">\r\n                                                            <th>FOTO</th>\r\n                                                            <th>NOMBRE COMPLETO</th>\r\n                                                            <th>SECTOR</th>\r\n                                                            <th>NIVEL ACADEMICO</th>\r\n                                                            <th>USUARIO</th>\r\n                                                        </table>\r\n                                                    </fieldset>\r\n                                                </div>\r\n                                            </div>-->\r\n                                            <table class=\"table\" id=\"dataTabla\">\r\n                                                <thead>\r\n                                                <tr>\r\n                                                    <th>FOTO</th>\r\n                                                    <th>NOMBRE COMPLETO</th>\r\n                                                    <th>SECTOR</th>\r\n                                                    <th>NIVEL ACADEMICO</th>\r\n                                                    <th>USUARIO</th>\r\n\r\n                                                </tr>\r\n                                                </thead>\r\n                                                <tbody id=\"formLista\" name=\"formLista\">\r\n                                                <tr th:each=\"aux : ${formularios}\" >\r\n\r\n                                                </tr>\r\n                                                </tbody>\r\n\r\n                                            </table>\r\n                                            <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js\"></script>\r\n                                            <script th:inline=\"javascript\">\r\n\r\n                                                /*<![CDATA[*/\r\n                                                // var forms = JSON.parse([[${formularios}]]);\r\n                                                var forms = JSON.parse(/*[[${formularios}]]*/ 'default');\r\n\r\n\r\n                                                /*]]>*/\r\n\r\n                                                // '[{\\\"id\\\":1,\\\"name\\\":\\\"Juan\\\",\\\"sector\\\":\\\"Santiago\\\",\\\"academicLevel\\\":\\\"Grado\\\",\\\"photo\\\":{\\\"fotoBase64\\\":\\\"\\\"},\\\"user\\\":{\\\"username\\\":\\\"admin\\\",\\\"fullName\\\":\\\"Samuel PeÔøΩa\\\",\\\"password\\\":\\\"admin\\\",\\\"rolesList\\\":[\\\"ROLE_EMPLEADO\\\",\\\"ROLE_ADMIN\\\"]},\\\"location\\\":{\\\"longitude\\\":-70.663414,\\\"latitude\\\":19.453105}}, {\\\"id\\\":2,\\\"name\\\":\\\"Soto Bello\\\",\\\"sector\\\":\\\"Santiago\\\",\\\"academicLevel\\\":\\\"Doctorado\\\",\\\"photo\\\":{\\\"fotoBase64\\\":\\\"\\\"},\\\"user\\\":{\\\"username\\\":\\\"admin\\\",\\\"fullName\\\":\\\"Samuel PeÔøΩa\\\",\\\"password\\\":\\\"admin\\\",\\\"rolesList\\\":[\\\"ROLE_EMPLEADO\\\",\\\"ROLE_ADMIN\\\"]},\\\"location\\\":{\\\"longitude\\\":-70.644531,\\\"latitude\\\":19.453105}}, {\\\"id\\\":3,\\\"name\\\":\\\"Dilapa Batista\\\",\\\"sector\\\":\\\"Santiago\\\",\\\"academicLevel\\\":\\\"Medio\\\",\\\"photo\\\":{\\\"fotoBase64\\\":\\\"\\\"},\\\"user\\\":{\\\"username\\\":\\\"admin\\\",\\\"fullName\\\":\\\"Samuel PeÔøΩa\\\",\\\"password\\\":\\\"admin\\\",\\\"rolesList\\\":[\\\"ROLE_EMPLEADO\\\",\\\"ROLE_ADMIN\\\"]},\\\"location\\\":{\\\"longitude\\\":-70.664787,\\\"latitude\\\":19.473174}}]'\r\n                                                console.log(\"forms: \")\r\n                                                //console.log(forms)\r\n                                                productListSuccess(forms)\r\n\r\n                                                function productListSuccess(formularios) {\r\n                                                    console.log(\"aqui: \")\r\n\r\n\r\n                                                    var fila = \"\"\r\n                                                    for (var key in formularios) {\r\n                                                        fila += \"<tr>\"\r\n                                                        fila += \"<td>\" + \"<img src=\" +\"data:\"+formularios[key].photo.mimeType+\";base64,\"+ formularios[key].photo.fotoBase64 + \" style=\\\"height: 100px; width: 100px\\\" alt=\\\"No tiene foto\\\" >\" + \"</td>\"\r\n\r\n                                                        //src=\"@{'data:'+${aux.getMimeType()}+';base64,'+${aux.getFotoBase64()}}\"\r\n                                                        fila += \"<td>\" + formularios[key].name + \"</td>\"\r\n                                                        fila += \"<td>\" + formularios[key].sector + \"</td>\"\r\n                                                        fila += \"<td>\" + formularios[key].academicLevel + \"</td>\"\r\n                                                        fila += \"<td>\" + formularios[key].user.username + \"</td>\"\r\n                                                        fila += \"</tr>\"\r\n                                                    }\r\n                                                    document.getElementById(\"formLista\").innerHTML = fila\r\n\r\n                                                }\r\n                                            </script>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n                <div class=\"clearfix\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script>\r\n    function GEOLOCATION(){\r\n\r\n        function success(pos){\r\n            console.log('Working...')\r\n            var crd = pos.coords\r\n            document.querySelector(\"#latitude\").value = crd.latitude;\r\n            document.querySelector(\"#longitude\").value = crd.longitude;\r\n        }\r\n        navigator.geolocation.getCurrentPosition(success)\r\n    }\r\n\r\n</script>\r\n\r\n\r\n<!-- END WRAPPER -->\r\n\r\n</body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/build/resources/main/public/RestTemplate/formRest.html b/build/resources/main/public/RestTemplate/formRest.html
--- a/build/resources/main/public/RestTemplate/formRest.html	(revision 2e20585f3e432e4febd960c5e73b67664898b0df)
+++ b/build/resources/main/public/RestTemplate/formRest.html	(date 1620007270023)
@@ -131,9 +131,11 @@
                                                 <thead>
                                                 <tr>
                                                     <th>FOTO</th>
-                                                    <th>NOMBRE COMPLETO</th>
+                                                    <th>NOMBRE</th>
                                                     <th>SECTOR</th>
-                                                    <th>NIVEL ACADEMICO</th>
+                                                    <th>N. ACADEMICO</th>
+                                                    <th>LONGITUDE</th>
+                                                    <th>LATITUDE</th>
                                                     <th>USUARIO</th>
 
                                                 </tr>
@@ -167,12 +169,14 @@
                                                     var fila = ""
                                                     for (var key in formularios) {
                                                         fila += "<tr>"
-                                                        fila += "<td>" + "<img src=" +"data:"+formularios[key].photo.mimeType+";base64,"+ formularios[key].photo.fotoBase64 + " style=\"height: 100px; width: 100px\" alt=\"No tiene foto\" >" + "</td>"
+                                                        fila += "<td>" + "<img src="+formularios[key].photo.fotoBase64 + " style=\"height: 100px; width: 100px\" alt=\"No tiene foto\" >" + "</td>"
 
                                                         //src="@{'data:'+${aux.getMimeType()}+';base64,'+${aux.getFotoBase64()}}"
                                                         fila += "<td>" + formularios[key].name + "</td>"
                                                         fila += "<td>" + formularios[key].sector + "</td>"
                                                         fila += "<td>" + formularios[key].academicLevel + "</td>"
+                                                        fila += "<td>" + formularios[key].location.longitude + "</td>"
+                                                        fila += "<td>" + formularios[key].location.latitude + "</td>"
                                                         fila += "<td>" + formularios[key].user.username + "</td>"
                                                         fila += "</tr>"
                                                     }
